<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Professional Energy Terminal</title>
  <style>
    /* Your existing styles here */
  </style>
</head>
<body>
  <h1>Professional Energy Terminal</h1>
  <!-- Example data tables -->
  <section id="stocks-section">
    <h2>Stocks</h2>
    <table>
      <thead><tr><th>Symbol</th><th>Price</th><th>Change</th></tr></thead>
      <tbody id="stockData">
        <!-- Filled by JS -->
      </tbody>
    </table>
  </section>

  <section id="commodities-section">
    <h2>Commodities</h2>
    <table>
      <thead><tr><th>Name</th><th>Price</th><th>Unit</th></tr></thead>
      <tbody id="commodityData">
        <!-- Filled by JS -->
      </tbody>
    </table>
  </section>

  <section id="news-section">
    <h2>News</h2>
    <div id="newsApiStats"></div>
    <ul id="newsData">
      <!-- Filled by JS -->
    </ul>
  </section>

  <button id="debugToggle">Toggle Debug</button>
  <pre id="debugLog"></pre>

  <script>
    // ============= CONFIG & KEYS =============
    const CORS_PROXY = '';   // no proxy in use
    const API_KEYS = {
      FINNHUB:    'd20i9lpr01qrk6cl5adgd20i9lpr01qrk6cl5ae0',
      TWELVEDATA: 'b7bc43ebc653428cb1a5d968a23b67ee',
      CURRENTS:   '5vexUPN43TdFfjFM_BdejcR9lnE_JyDHU-ceWHbIb-GG4Iy5',
      GNEWS:      '22b87731ed1048479c91c7b1831303ca',
      MEDIASTACK: 'c2ddab844edc121d2d7d3c84f450ae9e'
    };

    // ============= UTILS =============
    const REFRESH_CONFIG = {
      stocks:      { interval: 60000,   symbols: ['XOM','CVX','BP'] },
      commodities: { interval: 300000,  items: ['CL=F','NG=F'] },
      news:        { interval: 900000,  query: 'energy' }
    };

    let apiStats = {
      yahoo:      { success: 0, failed: 0 },
      finnhub:    { success: 0, failed: 0 },
      twelvedata: { success: 0, failed: 0 },
      currents:   { success: 0, failed: 0 },
      mediastack: { success: 0, failed: 0 }
    };

    // ============= FETCH FUNCTIONS =============
    async function fetchFromYahooWithProxy(symbol) {
      const url = `${CORS_PROXY}https://query1.finance.yahoo.com/v7/finance/quote?symbols=${symbol}`;
      try {
        const res = await fetch(url);
        const data = await res.json();
        apiStats.yahoo.success++;
        return data.quoteResponse.result[0];
      } catch (e) {
        apiStats.yahoo.failed++;
        console.error('Yahoo fetch error:', e);
        return null;
      }
    }

    async function fetchFinnhubPrice(symbol) {
      const url = `https://finnhub.io/api/v1/quote?symbol=${symbol}&token=${API_KEYS.FINNHUB}`;
      try {
        const res = await fetch(url);
        const data = await res.json();
        apiStats.finnhub.success++;
        return data;
      } catch (e) {
        apiStats.finnhub.failed++;
        console.error('Finnhub fetch error:', e);
        return null;
      }
    }

    async function fetchTwelveData(symbol) {
      const url = `https://api.twelvedata.com/price?symbol=${symbol}&apikey=${API_KEYS.TWELVEDATA}`;
      try {
        const res = await fetch(url);
        const data = await res.json();
        apiStats.twelvedata.success++;
        return data;
      } catch (e) {
        apiStats.twelvedata.failed++;
        console.error('TwelveData fetch error:', e);
        return null;
      }
    }

    async function fetchCommodities() {
      const tbody = document.getElementById('commodityData');
      tbody.innerHTML = '';
      for (const item of REFRESH_CONFIG.commodities.items) {
        const url = `https://api.polygon.io/v1/last_quote/commodities/${item}?apiKey=M6qDtP6faizuLBGsbaOpoq3apRrVCe6h`;
        try {
          const res = await fetch(url);
          const data = await res.json();
          const row = `<tr><td>${item}</td><td>${data.last.price}</td><td>${data.last.size}</td></tr>`;
          tbody.insertAdjacentHTML('beforeend', row);
        } catch (e) {
          console.error('Commodities fetch error:', e);
        }
      }
    }

    async function fetchEnhancedNews() {
      const list = document.getElementById('newsData');
      list.innerHTML = '';
      // Example using NewsAPI
      try {
        const url = `https://newsapi.org/v2/everything?q=${encodeURIComponent(REFRESH_CONFIG.news.query)}&apiKey=${API_KEYS.GNEWS}`;
        const res = await fetch(url);
        const data = await res.json();
        apiStats.currents.success++;
        data.articles.slice(0, 5).forEach(a => {
          const li = `<li><a href='${a.url}' target='_blank'>${a.title}</a></li>`;
          list.insertAdjacentHTML('beforeend', li);
        });
      } catch (e) {
        apiStats.currents.failed++;
        console.error('News fetch error:', e);
      }
      updateApiStats();
    }

    // ============= UPDATE UI =============
    async function updateStocks() {
      const tbody = document.getElementById('stockData');
      tbody.innerHTML = '';
      for (const symbol of REFRESH_CONFIG.stocks.symbols) {
        const yf = await fetchFromYahooWithProxy(symbol);
        if (yf) {
          const row = `<tr><td>${symbol}</td><td>${yf.regularMarketPrice}</td><td>${yf.regularMarketChange.toFixed(2)}</td></tr>`;
          tbody.insertAdjacentHTML('beforeend', row);
        }
      }
      updateApiStats();
    }

    function updateApiStats() {
      document.getElementById('newsApiStats').innerHTML =
        `C:${apiStats.currents.success}/${apiStats.currents.failed}  M:${apiStats.mediastack.success}/${apiStats.mediastack.failed}`;
    }

    // ============= DEBUG =============
    function toggleDebug() {
      document.getElementById('debugLog').classList.toggle('hidden');
    }
    document.getElementById('debugToggle').onclick = toggleDebug;

    // ============= INIT & INTERVALS =============
    function startIntervals() {
      setInterval(updateStocks, REFRESH_CONFIG.stocks.interval);
      setInterval(fetchCommodities, REFRESH_CONFIG.commodities.interval);
      setInterval(fetchEnhancedNews, REFRESH_CONFIG.news.interval);
    }

    document.addEventListener('DOMContentLoaded', function() {
      console.log('ðŸš€ Professional Energy Terminal starting...');
      updateStocks();
      fetchCommodities();
      fetchEnhancedNews();
      startIntervals();
      console.log('âœ… Professional terminal ready with optimized refresh rates');
    });
  </script>
</body>
</html>
